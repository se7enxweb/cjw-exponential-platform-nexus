services:
    # HTTP Cache Control Header Listener - Fixes Cache-Control headers for proxy caching
    # Overrides aggressive FOSHttpCache directives and enables shared cache for public pages
    # Priority -1025: Runs LAST, after all other subscribers
    symfony_tools.listener.cache_control_header:
        class: Sevenx\SymfonyToolsBundle\EventListener\CacheControlHeaderListener
        public: true
        autowire: true
        autoconfigure: true
        tags:
            - { name: kernel.event_subscriber }

    # Final Cache Header Listener - Ultimate fallback to ensure proper cache headers
    # Uses PHP_INT_MIN priority to run absolutely last before response is serialized
    symfony_tools.listener.final_cache_header:
        class: Sevenx\SymfonyToolsBundle\EventListener\FinalCacheHeaderListener
        public: true
        tags:
            - { name: kernel.event_subscriber }

    # Security Token Session Listener - Ensures tokens are persisted to session
    symfony_tools.listener.security_token_session:
        class: Sevenx\SymfonyToolsBundle\EventListener\SecurityTokenSessionListener
        arguments:
            - '@security.token_storage'
        tags:
            - { name: kernel.event_listener, event: security.interactive_login, method: onSecurityInteractiveLogin }
