# enable litespeed cache by overriding cache-header
# RewriteRule .* - [E=cache-control:max-age=120]

########## Begin - Litespeed cache
#<IfModule LiteSpeed>
#    CacheLookup public on
#    RewriteEngine On
#    RewriteCond %{REQUEST_METHOD} ^GET|HEAD|PURGE$
#    RewriteCond %{REQUEST_URI} !ngadminui [NC]
#    RewriteRule .* - [E=Cache-Control:max-age=10]
#</IfModule>
########## End - Litespeed cache


# Security Headers
# check with webservice https://observatory.mozilla.org/

# Content Security Policy
# Pre-existing site that uses too much inline code to fix
# but wants to ensure resources are loaded only over https and disable plugins
Header set Content-Security-Policy "default-src https: 'unsafe-eval' 'unsafe-inline'; object-src 'none'; frame-ancestors 'self'"
# Header set Content-Security-Policy "default-src 'none'; script-src 'self' 'unsafe-inline'; style-src 'self'; img-src 'self' data:; frame-ancestors 'self'; report-uri https://jac-systeme.de/r/d/csp/reportOnly'"

# HTTP Strict Transport Security
# Only connect to this site and subdomains via HTTPS for the next two years
Header set Strict-Transport-Security "max-age=63072000; includeSubDomains"

# X-Frame-Options
# Only allow my site to frame itself
# Header set Content-Security-Policy "frame-ancestors 'self'" # see above
Header set X-Frame-Options "SAMEORIGIN"

# X-Content-Type-Options
# Prevent browsers from incorrectly detecting non-scripts as scripts
Header set X-Content-Type-Options "nosniff"

# Referrer Policy
# Only send the shortened referrer to a foreign origin, full referrer to a local host
Header set Referrer-Policy "strict-origin-when-cross-origin"

# X-XSS-Protection
# Block pages from loading when they detect reflected XSS attacks
Header set X-XSS-Protection: "1; mode=block"

# End Security Headers





## eZ Platform/Symfony ENVIRONMENT variables, for customizing app.php* execution
# * Only SYMFONY_ENV and SYMFONY_DEBUG supported by console command, rest are eZ Platform features in app.php.

# Environment.
# Possible values: "prod" and "dev" out-of-the-box, other values possible with proper configuration
# Defaults to "prod" if omitted (uses SetEnvIf so value can be used in rewrite rules)
#SetEnvIf REQUEST_URI ".*" SYMFONY_ENV=prod

# Whether to use debugging.
# Possible values: 0 or 1
# Defaults to 0 if omitted, unless SYMFONY_ENV is set to: "dev"
#SetEnv SYMFONY_DEBUG 0

# Optional: Whether to use Symfony's builtin HTTP Caching Proxy.
# Disable it if you are using an external reverse proxy (e.g. Varnish)
# Possible values: 0 or 1
# Defaults to 1 if omitted, unless SYMFONY_ENV is set to: "dev"
# SetEnv SYMFONY_HTTP_CACHE 0

# Defines the proxies to trust.
# Separate entries by a comma
# Example: "ip1,ip2"
# By default, no trusted proxies are set
#SetEnv SYMFONY_TRUSTED_PROXIES "127.0.0.1"

# TIP: There are many more environment variables supported by eZ Platform. However unlike those listed above
#      they should in most cases rather be set in the environment then in vhost config to make sure cronjobs
#      and cli command usage takes them into account as well.

AddOutputFilterByType DEFLATE text/plain
AddOutputFilterByType DEFLATE text/html
AddOutputFilterByType DEFLATE text/xml
AddOutputFilterByType DEFLATE text/css
AddOutputFilterByType DEFLATE application/xml
AddOutputFilterByType DEFLATE application/json
AddOutputFilterByType DEFLATE application/xhtml+xml
AddOutputFilterByType DEFLATE application/rss+xml
AddOutputFilterByType DEFLATE application/javascript
AddOutputFilterByType DEFLATE application/x-javascript

AddDefaultCharset UTF-8

DirectoryIndex app.php

Options +FollowSymlinks
Options -Indexes

RewriteEngine On

# DEBUG: Log all POST /login_check requests to see if .htaccess is processing them
# RewriteCond %{REQUEST_METHOD} ^POST$
# RewriteCond %{REQUEST_URI} ^/login_check
# RewriteRule ^ - [E=HTACCESS_LOGIN_CHECK:1,L]

RewriteCond %{REQUEST_URI} \.svn|\.git
RewriteRule .* / [L,R=301]

RewriteCond %{ENV:REDIRECT_STATUS} ^$
RewriteRule ^app(_.+)?\.php(/(.*)|$) /$3 [R=301,L]

# Let's Encrypt support
RewriteRule ^\.well-known/acme-challenge/ - [L]

# START: Multisite rewrite rules for robots.txt

# RewriteRule ^robots_site1.txt$ - [L]
# RewriteCond %{HTTP_HOST} ^site1.example.com$ [NC]
# RewriteRule ^robots.txt$ robots_site1.txt [L]

# RewriteRule ^robots_site2.txt$ - [L]
# RewriteCond %{HTTP_HOST} ^site2.example.com$ [NC]
# RewriteRule ^robots.txt$ robots_site2.txt [L]

# END: Multisite rewrite rules for robots.txt

# START: Maintenance mode

# RewriteRule ^offline_eng.html$ - [L]

# RewriteRule .* offline_eng.html [R=503,L]
# ErrorDocument 503 /offline_eng.html

# END: Maintenance mode

# Disable .php(3) and other executable extensions in the var directory
RewriteRule ^var/.*(?i)\.(php3?|phar|phtml|sh|exe|pl|bin)$ - [F]

RewriteRule ^var/([^/]+/)?storage/images(-versioned)?/.* - [L]
RewriteRule ^var/([^/]+/)?storage/original/image/(.*)\.svg - [L]
RewriteRule ^var/([^/]+/)?cache/(texttoimage|public)/.* - [L]
RewriteRule ^design/[^/]+/(stylesheets|images|fonts|javascript)/.* - [L]
RewriteRule ^share/icons/.* - [L]
RewriteRule ^extension/[^/]+/design/[^/]+/(stylesheets|flash|images|fonts|lib|javascripts?)/.* - [L]

RewriteRule ^favicon\.ico - [L]
RewriteRule ^robots\.txt - [L]

# Allow direct access to legacy assets and design folders
RewriteCond %{REQUEST_URI} ^/(assets|bundles|design|extension)/
RewriteRule ^ - [L]

# The following rules are needed to correctly display bundle and project assets
RewriteRule ^bundles/ - [L]
RewriteRule ^assets/ - [L]

RewriteRule .* app\.php
