{# content \Netgen\EzPlatformSiteApi\API\Values\Content #}
{# location \Netgen\EzPlatformSiteApi\API\Values\Location #}

{% from '@ezdesign/parts/macros/cjw_macros.html.twig' import
    cjw_css_content_class as css_content_class
%}
{% from '@ezdesign/parts/macros/cjw_render_content.html.twig' import
    gallery_item as render_gallery_item
%}

{% set gallery_item_content_types = ezpublish.configResolver.hasParameter( 'content.gallery.item_content_types', 'cjwsite' ) ?
    ezpublish.configResolver.parameter( 'content.gallery.item_content_types', 'cjwsite' ) : ['image', 'ng_video']%}

{% set gallery_items = cjw_fetch_content( [[location.id]], {
    'depth' : 1,
    'include' : gallery_item_content_types,
    'count' : true
} )[0] %}

{% set gallery_item_count = gallery_items['count'] %}
{% set gallery_items = gallery_items['children'] %}

{% set column_count = (content.hasField('column_count')) ? content.fields.column_count.value.value|default(3) : 3 %}
{% set column_class_count = 12 / column_count %}

{# TODO ggf. images selbst fetchen und hier loopen + css classes #}

    <div class="view-type view-type-{{ view_type }} ng-gallery cjw-gallery {{ css_content_class( content ) }}">

        <div class="gallery-title">
{#            <h2>#}
                {{ ng_render_field(content.fields.title) }}
{#            </h2>#}
        </div>

        <div class="gallery-body">
            {% if not content.fields.teaser_intro.empty %}
                <div class="article-intro">
                    {{ ng_render_field(content.fields.teaser_intro) }}
                </div>
            {% endif %}

            {% if not content.fields.description.empty %}
                {{ ng_render_field(content.fields.description) }}
            {% endif %}
        </div>

        {% if gallery_item_count %}
            <div class="row no-gutters gallery-items">
            {% for gallery_item in gallery_items %}
                {# @CheckMe: Check whether the classes for "md" and "sm"
                             viewports shall be also set automatically. #}
                <div class="col-sm-6 col-md-6 col-lg-{{ column_class_count }} {{ css_content_class( gallery_item.content ) }}">
                    {{ render_gallery_item( gallery_item ) }}
                </div>
            {% endfor %}
            </div>
        {% endif %}

        {#{{ render(
            controller(
                'ngsite.controller.parts:viewRelatedMultimediaItems', {
                'locationId': location.id,
                'includeChildren': true,
                'contentTypeIdentifiers': ['image', 'ng_video'],
                'template': '@ezdesign/parts/related_multimedia.html.twig'
            }
            )
        ) }}#}


    </div>


{#{% endblock %}#}
