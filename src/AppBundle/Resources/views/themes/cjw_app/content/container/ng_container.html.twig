{# content \Netgen\EzPlatformSiteApi\API\Values\Content #}
{# location \Netgen\EzPlatformSiteApi\API\Values\Location #}

{% import '@ezdesign/parts/content_fields.html.twig' as content_fields %}
{% import '@ezdesign/parts/macros/cjw_macros.html.twig' as cjw_macros %}

{% import '@ezdesign/parts/macros/cjw_content_fields.html.twig' as cjw_content_fields %}

{% set image_alias = 'i1200_16-9' %}

{% if content.fields.image_crop is defined and not content.fields.image_crop.value.bool %}
    {% set image_alias = 'i770' %}
{% endif %}

{% set col_content = 'col-12 col-sm-12 col-md-6 col-lg-6' %}
{% set col_image   = 'col-12 col-sm-12 col-md-6 col-lg-6' %}

{% if 'line_il' in view_type %}
    {% set col_content = 'col-12 col-sm-6 col-md-6 col-lg-6' %}
    {% set col_image   = 'col-12 col-sm-6 col-md-6 col-lg-6' %}
{% endif %}

{% if '40_60_img_left_plus_list' in view_type %}
    {% set col_content = 'col-12 col-sm-12 col-md-12 col-lg-7dot2' %}
    {% set col_image   = 'col-12 col-sm-12 col-md-12 col-lg-4dot8' %}
{% endif %}

{# {% if 'line_60_40_ir_plus' or 'line_40_60_il_plus' in view_type %} #}
{#    {% set col_content = 'col-12 col-sm-12 col-md-6 col-lg-7dot2' %} #}
{#    {% set col_image   = 'col-12 col-sm-12 col-md-6 col-lg-4dot8' %} #}
{# {% endif %} #}

{#  {% if 'line_40_60_il' in view_type  %}
    {% set col_content = 'col-12 col-sm-12 col-md-6 col-lg-7dot2' %}
    {% set col_image   = 'col-12 col-sm-12 col-md-6 col-lg-4dot8' %}
{% endif %} #}

{% set show_submenu = 'none' %}
{% if children_submenu is defined and children_submenu != 'none' %}
    {% set show_submenu = children_submenu %}
{% endif %}

<article
    class="view-type view-type-line view-type-{{ view_type }}{# {{ content.contentInfo.contentTypeIdentifier|replace({'_': '-'}) }} #}">
    <div class="row">

        {% if image_position is defined and image_position != 'right' %}
            <header class="article-header-md">
                <h1 class="title">
                    {% if content.fields.body is defined and content.fields.body.empty %}
                        {{ content_fields.title(content) }}
                    {% else %}
                        {#                        <a {{ cjw_macros.content_relation_parameters( location, location.content ) }}>{{ content_fields.title(content) }}</a> #}
                        {{ content_fields.title(content) }}
                    {% endif %}

                    {% if content.fields.sub_title is defined and not content.fields.sub_title.empty %}
                        <small>
                            {{ ng_render_field( content.fields.sub_title ) }}
                        </small>
                    {% endif %}
                </h1>
            </header>
            <div class="{{ col_image }}{# article-image #} image-left">
                {% if content.fields.body is defined and content.fields.body.empty %}
                    {{ content_fields.image(content, null, image_alias) }}
                {% else %}
                    {# {{ content_fields.image(content, location, image_alias) }} #}
                    <a href="{{ asset(ng_image_alias(content.fields.image, 'i1200').uri) }}"
                       data-fancybox="{{ view_type }}" alt="{{ content.fields.image.value.alternativeText }}">
                        {{ content_fields.image(content, null, 'i770') }}
                    </a>
                {% endif %}
            </div>
        {% endif %}

        {% if image_position is defined and image_position != 'left' %}
            <header class="article-header-md">
                <h1 class="title">
                    {% if content.fields.body is defined and content.fields.body.empty %}
                        {{ content_fields.title(content) }}
                    {% else %}
                        <a {{ cjw_macros.content_relation_parameters( location, location.content ) }}>{{ content_fields.title(content) }}</a>
                    {% endif %}

                    {% if content.fields.sub_title is defined and not content.fields.sub_title.empty %}
                        <small>
                            {{ ng_render_field( content.fields.sub_title ) }}
                        </small>
                    {% endif %}
                </h1>
            </header>
        {% endif %}

        <div class="{{ col_content }} article-content">
            <header class="article-header">
                <h1 class="title">
                    {% if content.fields.body is defined and content.fields.body.empty %}
                        {{ content_fields.title(content) }}
                    {% else %}
                        {#                        <a {{ cjw_macros.content_relation_parameters( location, location.content ) }}>{{ content_fields.title(content) }}</a> #}
                        {{ content_fields.title(content) }}
                    {% endif %}

                    {% if content.fields.sub_title is defined and not content.fields.sub_title.empty %}
                        <small>
                            {{ ng_render_field( content.fields.sub_title ) }}
                        </small>
                    {% endif %}
                </h1>
            </header>

            {% if image_position is defined and image_position != 'left' %}
                <div class="image-right_sm">
                    {% if content.fields.body is defined and content.fields.body.empty %}
                        {{ content_fields.image(content, null, image_alias) }}
                    {% else %}
                        {{ content_fields.image(content, location, image_alias) }}
                    {% endif %}
                </div>
            {% endif %}

            <div class="short">
                {% if content.fields.full_intro is defined and not content.fields.full_intro.empty %}
                    {{ ng_render_field( content.fields.full_intro ) }}
                {% elseif content.fields.teaser_intro is defined and not content.fields.teaser_intro.empty %}
                    {{ ng_render_field( content.fields.teaser_intro ) }}
                {% endif %}

                {% if content.fields.body is defined and not content.fields.body.empty %}
                    <a {{ cjw_macros.content_relation_parameters( location, location.content, '', 'read-more' ) }}>
                        {{ 'cjwsite.content.links.read_more'|trans }}
                    </a>
                {% endif %}
            </div>

            {% if show_submenu != 'none' %}
                {% set menu_content_types = ezpublish.configResolver.getParameter( 'container_menu.content_types', 'cjwsite' ) %}

                {% set list_menu_locations = cjw_fetch_content( [[content.mainLocation.id]], {
                    'depth' : 1,
                    'include' : menu_content_types,
                    'datamap': false,
                    'count' : true,
                    'priority' : [[ '>=', 0 ]]
                } )[0] %}

                {% if list_menu_locations.count > 0 %}
                    {% if show_submenu == 'list_icons' %}

                        <div class="row container-menu-list_icons">
                            {% for child in list_menu_locations.children %}
                                <div class="col-12 col-sm-6">
                                    <div class="col">
                                        {% if child.content.fields.icon_title is defined and not child.content.fields.icon_title.empty %}
                                            <img src="{{ ng_image_alias(child.content.fields.icon_title, 'i160').uri }}"
                                                 alt="{{ child.content.fields.icon_title.value.alternativeText }}"/>
                                            <a {{ cjw_macros.content_relation_parameters( child, child.content ) }}>
                                                {{ child.content.name }}
                                            </a>

                                        {% else %}
                                            <a {{ cjw_macros.content_relation_parameters( child, child.content ) }}>
                                                {{ child.content.name }}
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            {% endfor %}
                        </div>

                    {% elseif show_submenu == 'list' %}
                        <div class="row container-menu-list">
                            {% for child in list_menu_locations.children %}
                                <div class="col-xxs-12 col-sm-6">
                                    <a {{ cjw_macros.content_relation_parameters( child, child.content ) }}>
                                        {{ child.content.name }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>

                    {% else %}

                        <div class="row container-menu-tags">
                            {% for child in list_menu_locations.children %}
                                <div class="col-xxs-12 col-sm-6 col-md-4">
                                    <a {{ cjw_macros.content_relation_parameters( child, child.content ) }}>
                                        {{ child.content.name }}
                                    </a>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>

        {% if image_position is not defined or image_position != 'left' %}
            <div class="{{ col_image }} image-right">
                {% if content.fields.body is defined and content.fields.body.empty %}
                    {{ content_fields.image(content, null, image_alias) }}
                {% else %}
                    {{ content_fields.image(content, location, image_alias) }}
                {% endif %}
            </div>
        {% endif %}

    </div>
</article>
