{# content \Netgen\EzPlatformSiteApi\API\Values\Content #}
{# location \Netgen\EzPlatformSiteApi\API\Values\Location #}

{% extends nglayouts.layoutTemplate %}

{% import '@ezdesign/parts/content_fields.html.twig' as content_fields %}

{% set show_path = true %}

{% if not content.fields.teaser_intro.empty %}
    {% set meta_data = {'description': content.fields.teaser_intro.value.xml.saveXML()|striptags|trim|truncate(152)} %}
{% elseif not content.fields.full_intro.empty %}
    {% set meta_data = {'description': content.fields.full_intro.value.xml.saveXML()|striptags|trim|truncate(152)} %}
{% endif %}

{% block content %}
    <article class="view-type view-type-{{ view_type }} ng-article vf1">
        {% block content_header %}
            {% block title %}
                <h1 class="title{#full-page-title#}">{{ ng_render_field(content.fields.title) }}</h1>
            {% endblock %}

            {% block intro %}
                {% if not content.fields.full_intro.empty %}
                    <div class="article-intro">
                        {{ ng_render_field(content.fields.full_intro) }}
                    </div>
                {% elseif not content.fields.teaser_intro.empty %}
                    <div class="article-intro">
                        {{ ng_render_field(content.fields.teaser_intro) }}
                    </div>
                {% endif %}
            {% endblock %}
        {% endblock %}

        {% block content_body %}
            <div class="container">
                {% block image %}
                    {% if not content.fields.image.empty or not content.fields.related_multimedia.empty %}
                        <div class="full-article-image">
                            {{ render(
                                controller(
                                    'ngsite.controller.parts:viewRelatedMultimediaItems', {
                                        'locationId': location.id,
                                        'includeChildren': true,
                                        'contentTypeIdentifiers': ['image', 'ng_video'],
                                        'template': '@ezdesign/parts/related_multimedia.html.twig'
                                    }
                                )
                            ) }}
                        </div>
                    {% endif %}
                {% endblock %}

                <div class="full-article-content">
                    {% block body %}
                        {% if not content.fields.body.empty %}
                            <div class="full-article-body">
                                {{ ng_render_field(content.fields.body) }}
                            </div>
                        {% endif %}

                        {% if ( content.fields.location is defined and not content.fields.location.empty ) %}
                            <br />

                            <div class="toggle-block {#hide-me#} state-opened">
                                <div class="control">
                                    <span class="text-is-closed"><strong>Karte:</strong> Öffnen</span>
                                    <span class="text-is-opened"><strong>Karte:</strong> Schließen</span>
                                </div>

                                <div class="content">
                                    {% include "@ezdesign/parts/leaflet_map_single.html.twig" %}

                                    <div style="clear: both; height: 1px;"></div>
                                </div>
                            </div>
                        {% endif %}
                    {% endblock %}
                </div>
            </div>
            <div style="clear: both"></div>
        {% endblock %}
    </article>
{% endblock %}
