# ============================================================================
# Exponential Platform Nexus Configuration - Integrated with CJW structure
# ============================================================================
# This is the main ezPlatform configuration file that consolidates all critical
# platform settings with imports for modular configuration files.
#
# Configuration Merge Order (Symfony reads in this sequence):
# 1. Imports (external files loaded first)
# 2. ez_platform_standard_design (kernel template settings)
# 3. ezpublish block (all platform configuration)
#
# Note: Imports can be commented out to disable specific configuration modules
# without affecting the main system operation.

# ============================================================================
# IMPORTS - External Configuration Files
# ============================================================================
# These files are loaded in the order specified. Each file extends or overrides
# previous configuration. Later imports take precedence.
#
# - ngadminui.yml: Netgen Admin UI bundle configuration
# - ezplatform_siteaccess_defaults.yml: Siteaccess definitions and per-siteaccess
#   system configuration (languages, content trees, subtree paths)
# - ezplatform_siteaccess.yml: Additional siteaccess routing and configuration
# - @NetgenAdminUIBundle/Resources/config/ezplatform.yml: Netgen Admin UI integration
# - @AppBundle/Resources/config/ezplatform.yml: Application-specific configuration
imports:
    - { resource: 'ngadminui.yml' }
    - { resource: 'ezplatform_siteaccess_defaults.yml' }
    - { resource: 'ezplatform_siteaccess.yml' }
    - { resource: '@NetgenAdminUIBundle/Resources/config/ezplatform.yml' }
    - { resource: '@AppBundle/Resources/config/ezplatform.yml' }

# ============================================================================
# EZPUBLISH - Core Platform Configuration
# ============================================================================
ezpublish:

    # ========================================================================
    # URL ALIAS CONFIGURATION
    # ========================================================================
    # Configures URL alias behavior and slug conversion rules
    url_alias:
        slug_converter:
            # Transformation type for URL aliases: 'urlalias_lowercase' converts all
            # slugs to lowercase for consistent URL formatting
            transformation: 'urlalias_lowercase'

    # ========================================================================
    # HTTP CACHE - Caching Strategy and Purge Configuration
    # ========================================================================
    # By default 'local' uses Symfony HttpCache Proxy. Set to 'http' to point to Varnish.
    # Varnish purge configuration is managed via http_cache section in system.default
    http_cache:
        # Purge type: 'local' (Symfony HttpCache) or 'http' (Varnish/external proxy)
        purge_type: '%purge_type%'

    # ========================================================================
    # IMAGEMAGICK - Image Processing Configuration
    # ========================================================================
    # ImageMagick handles image manipulation, conversion, and processing for uploaded images
    imagemagick:
        # Set to false to disable ImageMagick processing; images will not be processed/converted
        enabled: true
        # Path to ImageMagick installation (e.g., /usr/bin/convert on Linux)
        path: '%imagemagick_path%'

    # ========================================================================
    # REPOSITORIES - Content Storage and Search Configuration
    # ========================================================================
    # Defines how content is stored and searched (database + search engine configuration)
    repositories:
        default:
            # Field groups for content organization
            fields_groups:
                list: [content, meta, extras]
            # Storage backend (null/~ means use default database storage)
            storage: ~
            # Search engine configuration (e.g., Solr, Elasticsearch, legacy SQL)
            search:
                # Search engine type: '%search_engine%' typically resolves to 'solr' or 'legacy'
                engine: '%search_engine%'
                # Connection name for the search engine (must match connection defined elsewhere)
                connection: default

    # ========================================================================
    # SYSTEM - Per-SiteAccess and Global Configuration
    # ========================================================================
    # Configuration is read in this order (first match wins):
    # 1. system.<siteaccess-specific>     - Per-siteaccess settings
    # 2. system.<siteaccess-group>        - Group settings (e.g., admin_group, site_group)
    # 3. system.default                   - Default/fallback settings
    # 4. system.global                    - Global settings (if defined)
    #
    # TIP: For multisite installations, organize shared config into SiteAccess groups.
    #      For single-site, place shared config under "default" for simplicity.
    system:
        # ====================================================================
        # DEFAULT - Global Fallback Configuration for All SiteAccesses
        # ====================================================================
        default:
            # Content repository to use for this siteaccess
            repository: default

            # Cache pool service name. Should be different per repository in multi-repo installs.
            # This determines which cache backend stores content/template cache for this siteaccess.
            cache_service_name: '%cache_pool%'

            # Var directory for this siteaccess (stores cache, sessions, logs, etc.)
            # Note: These settings are set at installation time. Changing var_dir after installation
            # requires manual database updates to reflect paths, otherwise exceptions will occur.
            var_dir: var/site

            # Content settings for this siteaccess
            content:
                # Default HTTP cache TTL for content responses.
                # EzSystemsPlatformHttpCacheBundle expires all affected cache on changes,
                # so TTL can be greatly increased. Error/redirect responses have separate TTL.
                default_ttl: '%httpcache_default_ttl%'

            # HttpCache (Varnish/Proxy) Purge Server Configuration
            # Used when ezpublish.http_cache.purge_type is set to 'http' (external cache purge)
            http_cache:
                # List of Varnish/cache proxy server addresses for purge requests
                # Format: ['http://host1:port', 'http://host2:port', ...]
                purge_servers: ['%purge_server%']
                # Token used to authenticate Varnish purge requests (security)
                varnish_invalidate_token: '%varnish_invalidate_token%'

        # ====================================================================
        # ADMIN_GROUP - Configuration for Admin SiteAccesses
        # ====================================================================
        # Applies to all siteaccesses in the 'admin_group' (defined in siteaccess config)
        # Typically: admin, legacy_admin, editor, nga (Netgen Admin UI)
        admin_group:
            # Content Tree Module Configuration
            # Defines which locations appear in the admin content tree left sidebar
            content_tree_module:
                # Root location IDs that can be browsed in the admin interface tree
                contextual_tree_root_location_ids:
                    - 2   # Home (Content structure)
                    - 5   # Users
                    - 43  # Media
                    - 48  # Setup

            # Subtree Paths Configuration
            # Maps logical names to location paths for content organization
            subtree_paths:
                content: /1/2/   # Content subtree root (under Home)
                media: /1/43/    # Media subtree root

